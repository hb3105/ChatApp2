{% extends 'base.html' %}

{% block title %}Chat Rooms{% endblock %}

{% block content %}
    {% if user.is_authenticated %}
        <h5>Chat Rooms</h5>
        <ul id="room-list">
            {% for room in rooms %}
                <li><a href="/chat/{{ room.name }}/">{{ room.name }}</a></li>
            {% empty %}
                <li>No rooms available.</li>
            {% endfor %}
        </ul>

        <h5>Create a new Chat Room</h5>
        <input id="room-name-input" type="text" size="100"><br>
        <input id="room-name-submit" type="button" value="Enter" disabled> <br>

        <form action="{% url 'users:logout' %}" method="post">
            {% csrf_token %}
            <button type="submit">Logout</button>
        </form>    
    {% else %}
        <h5>You can access this page only if you are logged in.</h5>
        <a href="{% url 'users:dashboard' %}">Dashboard</a>
    {% endif %}

    <script>
        const roomInput = document.querySelector('#room-name-input');
        const submitButton = document.querySelector('#room-name-submit');

        roomInput.focus();

        roomInput.oninput = function() {
            const roomName = roomInput.value.trim();
            submitButton.disabled = roomName === '';
        };

        roomInput.onkeyup = function(e) {
            if (e.keyCode === 13 && !submitButton.disabled) {  // enter, return
                submitButton.click();
            }
        };

        submitButton.onclick = function() {
            const roomName = roomInput.value.trim();
            console.log('Redirecting to room:', roomName);
            if (roomName) {
                window.location.pathname = '/chat/' + roomName + '/';
            }
        };
    </script>
{% endblock %}